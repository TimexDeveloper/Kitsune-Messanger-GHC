# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ Fox Messenger.

## ĞĞ±Ğ·Ğ¾Ñ€

Fox Messenger Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‚ĞµĞºĞ°:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (React)                      â”‚
â”‚  Next.js 14 App Router | TypeScript | Tailwind CSS | Zustandâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    API Routes
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Next.js API                             â”‚
â”‚            Serverless Functions on Vercel                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚PostgreSQLâ”‚      â”‚Vercel KVâ”‚     â”‚Vercel Blobâ”‚
   â”‚ Database â”‚      â”‚  Cache  â”‚     â”‚ Storage   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ¡Ğ»Ğ¾Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

### 1. Frontend Layer (src/app, src/components)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- UI/UX ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
- ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
- Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ñ API

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:**

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx              # Landing page
â”‚   â”œâ”€â”€ chat/page.tsx        # Chat interface
â”‚   â”œâ”€â”€ layout.tsx           # Root layout
â”‚   â””â”€â”€ api/                 # API routes
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ auth/                # Auth ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”œâ”€â”€ chat/                # Chat ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”œâ”€â”€ layout/              # Layout ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â””â”€â”€ ui/                  # UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â””â”€â”€ store/
    â””â”€â”€ index.ts             # Zustand store
```

### 2. API Layer (src/app/api)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
- Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° endpoints:**

```
/api
â”œâ”€â”€ /auth
â”‚   â”œâ”€â”€ /guest        (POST) - Create guest account
â”‚   â””â”€â”€ /session      (GET)  - Check session
â”œâ”€â”€ /messages
â”‚   â”œâ”€â”€ /            (GET/POST) - Get/create conversations
â”‚   â””â”€â”€ /[id]        (GET/POST) - Get/send messages
â”œâ”€â”€ /upload
â”‚   â””â”€â”€ /            (POST) - Upload image
â””â”€â”€ /users
    â””â”€â”€ /[id]        (GET) - Get user profile
```

### 3. Data Layer (src/lib/db)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- SQL queries
- Data persistence

**Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:**

```sql
users
â”œâ”€â”€ id (UUID)
â”œâ”€â”€ name (VARCHAR)
â”œâ”€â”€ email (VARCHAR, UNIQUE)
â”œâ”€â”€ is_guest (BOOLEAN)
â”œâ”€â”€ guest_name (VARCHAR)
â”œâ”€â”€ created_at (TIMESTAMP)
â””â”€â”€ last_active (TIMESTAMP)

conversations
â”œâ”€â”€ id (UUID)
â”œâ”€â”€ participant_ids (UUID[])
â”œâ”€â”€ last_message_at (TIMESTAMP)
â””â”€â”€ created_at (TIMESTAMP)

messages
â”œâ”€â”€ id (UUID)
â”œâ”€â”€ conversation_id (UUID, FK)
â”œâ”€â”€ sender_id (UUID, FK)
â”œâ”€â”€ content (TEXT)
â”œâ”€â”€ image_url (TEXT)
â”œâ”€â”€ type (ENUM: text/image)
â”œâ”€â”€ read_by (UUID[])
â””â”€â”€ created_at (TIMESTAMP)

calls
â”œâ”€â”€ id (UUID)
â”œâ”€â”€ conversation_id (UUID, FK)
â”œâ”€â”€ caller_id (UUID, FK)
â”œâ”€â”€ receiver_id (UUID, FK)
â”œâ”€â”€ type (ENUM: voice/video)
â”œâ”€â”€ status (ENUM: pending/active/ended)
â”œâ”€â”€ started_at (TIMESTAMP)
â”œâ”€â”€ ended_at (TIMESTAMP)
â””â”€â”€ duration (INTEGER)

guest_sessions
â”œâ”€â”€ token (VARCHAR, PRIMARY KEY)
â”œâ”€â”€ guest_name (VARCHAR)
â”œâ”€â”€ user_id (UUID, FK)
â”œâ”€â”€ created_at (TIMESTAMP)
â””â”€â”€ expires_at (TIMESTAMP)
```

### 4. State Management (src/store)

**Zustand stores:**

```typescript
// useAuthStore
- user: User | null
- isGuest: boolean
- setUser()
- logout()

// useChatStore
- conversations: Conversation[]
- selectedConversation: Conversation | null
- messages: Message[]
- addMessage()
- setMessages()

// useUIStore
- sidebarOpen: boolean
- darkMode: boolean
- setSidebarOpen()
- setDarkMode()
```

## ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ¾ÑÑ‚ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°

```
User Input (Guest Name)
    â†“
GuestLoginForm Component
    â†“
POST /api/auth/guest
    â†“
API Route Handler
    â”œâ”€ Validate input
    â”œâ”€ Generate token + userId
    â”œâ”€ Create user in DB
    â”œâ”€ Create guest session
    â””â”€ Return token
    â†“
Store in localStorage
    â†“
Redirect to /chat
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ

```
User Input (Message Text)
    â†“
Chat Component
    â†“
POST /api/messages/[conversationId]
    â†“
API Route Handler
    â”œâ”€ Validate token
    â”œâ”€ Validate content
    â”œâ”€ Create message in DB
    â”œâ”€ Update conversation
    â””â”€ Return message
    â†“
useChatStore.addMessage()
    â†“
UI re-renders with new message
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ

```
User selects file
    â†“
useImageUpload hook
    â†“
FormData with file
    â†“
POST /api/upload (multipart)
    â†“
API Route Handler
    â”œâ”€ Validate file
    â”œâ”€ Upload to Vercel Blob
    â”œâ”€ Generate URL
    â””â”€ Return imageUrl
    â†“
Send message with imageUrl
```

## ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸ ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### Ğ“Ğ¾ÑÑ‚ĞµĞ²Ğ°Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/guest                 â”‚
â”‚ { guestName: "John" }               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€ Generate token (crypto.randomBytes)
               â”œâ”€ Generate userId (crypto.randomUUID)
               â”œâ”€ Create user record
               â”œâ”€ Create session token
               â””â”€ Return { token, userId }
                    â”‚
                    â””â”€ Client stores in localStorage
                       (Used as Bearer token)
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµÑÑĞ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/auth/session                â”‚
â”‚ Authorization: Bearer <token>        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€ Validate token format
               â”œâ”€ Lookup session in DB
               â”œâ”€ Check if not expired
               â””â”€ Return user data
```

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° API endpoints

```typescript
// Middleware Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
if (!authHeader || !authHeader.startsWith('Bearer ')) {
  return 401 Unauthorized
}

const token = authHeader.substring(7);
const session = await getGuestSessionByToken(token);

if (!session || session.expires_at < NOW) {
  return 401 Unauthorized
}
```

### Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

- âœ… HTTPS on Vercel (automatic)
- âœ… NEXTAUTH_SECRET for session encryption
- âœ… Token expiration (30 days)
- âœ… Input validation on all endpoints
- âœ… CORS configured
- âœ… SQL injection prevention (parameterized queries)

## Performance

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

1. **Code Splitting**
   - Next.js automatic route-based code splitting
   - Dynamic imports for heavy components

2. **Caching**
   - Next.js ISR for static content
   - Client-side caching with Zustand
   - Optional: Vercel KV for server-side cache

3. **Database**
   - Indexed queries on conversation_ids, user_ids
   - Connection pooling via PRISMA_URL
   - Read replicas optional

4. **Frontend**
   - Image optimization with next/image
   - CSS minification with Tailwind
   - Tree-shaking with TypeScript

## ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ

### Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```
Vercel Edge Network
    â†“
â”œâ”€ Multiple serverless functions
â”œâ”€ Auto-scaling
â””â”€ Geographic distribution

Database
    â†“
â”œâ”€ Connection pooling
â”œâ”€ Read replicas
â””â”€ Auto-backup
```

### Ğ’ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

1. Upgrade Vercel plan (Pro, Enterprise)
2. Upgrade PostgreSQL plan
3. Add Redis for caching
4. Add CDN for static assets

## Ğ Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ

### Development

```bash
npm run dev
# Runs on localhost:3000
```

### Production (Vercel)

```
GitHub â†’ Vercel
   â†“
- Install dependencies
- Build (npm run build)
- Deploy serverless functions
- Cache on CDN
- Auto-SSL with HTTPS
```

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Logging

### Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸

1. **Build logs** - Vercel dashboard â†’ Deployments
2. **Runtime logs** - Vercel dashboard â†’ Functions
3. **Error tracking** - Browser console
4. **Database logs** - Vercel Postgres dashboard

## Future Architecture Improvements

1. **Real-time messaging**
   - WebSocket implementation
   - Socket.io or Pusher integration
   - Serverless WebSocket support

2. **WebRTC for calls**
   - STUN/TURN servers
   - Peer connection management
   - Media stream handling

3. **Encryption**
   - End-to-end encryption
   - TweetNaCl.js or libsodium.js

4. **Caching layer**
   - Redis for sessions
   - Redis for conversation cache
   - Memcached alternative

5. **Search**
   - Elasticsearch for message search
   - Full-text search optimization

6. **Analytics**
   - User activity tracking
   - Performance metrics
   - Error tracking (Sentry)

---

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ²ĞµÑ€ÑĞ¸Ñ:** 1.0
**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 2024-01-15
